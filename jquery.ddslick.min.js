(function(f){f.fn.ddslick=function(m){if(d[m]){return d[m].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof m==="object"||!m){return d.init.apply(this,arguments)}else{f.error("Method "+m+" does not exists.")}}};var d={},e={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,embedCSS:true,onSelected:function(){}},j='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',a='<ul class="dd-options"></ul>',c='<style id="css-ddslick" type="text/css">.dd-select{ border-radius:2px; border:solid 1px #ccc; position:relative; cursor:pointer;}.dd-desc { color:#aaa; display:block; overflow: hidden; font-weight:normal; line-height: 1.4em; }.dd-selected{ overflow:hidden; display:block; padding:10px; font-weight:bold;}.dd-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}.dd-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }.dd-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}.dd-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #ddd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}.dd-option{ padding:10px; display:block; border-bottom:solid 1px #ddd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }.dd-options > li:last-child > .dd-option{ border-bottom:none;}.dd-option:hover{ background:#f3f3f3; color:#000;}.dd-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }.dd-option-selected { background:#f6f6f6; }.dd-option-image, .dd-selected-image { vertical-align:middle; float:left; margin-right:5px; max-width:64px;}.dd-image-right { float:right; margin-right:15px; margin-left:5px;}.dd-container{ position:relative;} .dd-selected-text { font-weight:bold}</style>';d.init=function(n){var m=f.extend({},e,n);if(f("#css-ddslick").length<=0&&m.embedCSS){f(c).appendTo("head")}return this.each(function(){var x=f.extend({},e,n);var r=f(this),s=r.data("ddslick");if(!s){var p=[],q=x.data;r.find("option").each(function(){var z=f(this),y=z.data();p.push({text:f.trim(z.text()),value:z.val(),selected:z.is(":selected"),description:y.description,imageSrc:y.imagesrc})});if(x.keepJSONItemsOnTop){f.merge(x.data,p)}else{x.data=f.merge(p,x.data)}var o=r,u=f("<div>").attr("id",r.attr("id")+"-dd-placeholder");r.replaceWith(u);r=u;r.addClass("dd-container").append(j).append(a);r.find("input.dd-selected-value").attr("id",f(o).attr("id")).attr("name",f(o).attr("name"));var p=r.find(".dd-select"),w=r.find(".dd-options");w.css({width:x.width});p.css({width:x.width,background:x.background});r.css({width:x.width});if(x.height!=null){w.css({height:x.height,overflow:"auto"})}f.each(x.data,function(y,z){if(z.selected){x.defaultSelectedIndex=y}w.append('<li><a class="dd-option">'+(z.value?' <input class="dd-option-value" type="hidden" value="'+z.value+'" />':"")+(z.imageSrc?' <img class="dd-option-image'+(x.imagePosition=="right"?" dd-image-right":"")+'" src="'+z.imageSrc+'" />':"")+(z.text?' <label class="dd-option-text">'+z.text+"</label>":"")+(z.description?' <small class="dd-option-description dd-desc">'+z.description+"</small>":"")+"</a></li>")});var v={settings:x,original:o,selectedIndex:-1,selectedItem:null,selectedData:null};r.data("ddslick",v);if(x.selectText.length>0&&x.defaultSelectedIndex==null){r.find(".dd-selected").html(x.selectText)}else{var t=(x.defaultSelectedIndex!=null&&x.defaultSelectedIndex>=0&&x.defaultSelectedIndex<x.data.length)?x.defaultSelectedIndex:0;k(r,t)}r.find(".dd-select").on("click.ddslick",function(){g(r)});r.find(".dd-option").on("click.ddslick",function(){k(r,f(this).closest("li").index())});if(x.clickOffToClose){w.addClass("dd-click-off-close");r.on("click.ddslick",function(y){y.stopPropagation()});f("body").on("click",function(){f(".dd-open").removeClass("dd-open");f(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")})}}})};d.select=function(m){return this.each(function(){if(m.index!==undefined){k(f(this),m.index)}if(m.id){b(f(this),m.id)}})};d.open=function(){return this.each(function(){var n=f(this),m=n.data("ddslick");if(m){g(n)}})};d.close=function(){return this.each(function(){var n=f(this),m=n.data("ddslick");if(m){l(n)}})};d.destroy=function(){return this.each(function(){var o=f(this),n=o.data("ddslick");if(n){var m=n.original;o.removeData("ddslick").unbind(".ddslick").replaceWith(m)}})};function b(n,o){var m=n.find(".dd-option-value[value= '"+o+"']").parents("li").prevAll().length;k(n,m)}function k(r,t){var v=r.data("ddslick");var s=r.find(".dd-selected"),o=s.siblings(".dd-selected-value"),w=r.find(".dd-options"),m=s.siblings(".dd-pointer"),q=r.find(".dd-option").eq(t),n=q.closest("li"),p=v.settings,u=v.settings.data[t];r.find(".dd-option").removeClass("dd-option-selected");q.addClass("dd-option-selected");v.selectedIndex=t;v.selectedItem=n;v.selectedData=u;if(p.showSelectedHTML){s.html((u.imageSrc?'<img class="dd-selected-image'+(p.imagePosition=="right"?" dd-image-right":"")+'" src="'+u.imageSrc+'" />':"")+(u.text?'<label class="dd-selected-text">'+u.text+"</label>":"")+(u.description?'<small class="dd-selected-description dd-desc'+(p.truncateDescription?" dd-selected-description-truncated":"")+'" >'+u.description+"</small>":""))}else{s.html(u.text)}o.val(u.value);v.original.val(u.value);r.data("ddslick",v);l(r);h(r);if(typeof p.onSelected=="function"){p.onSelected.call(this,v)}}function g(q){var p=q.find(".dd-select"),n=p.siblings(".dd-options"),m=p.find(".dd-pointer"),o=n.is(":visible");f(".dd-click-off-close").not(n).slideUp(50);f(".dd-pointer").removeClass("dd-pointer-up");p.removeClass("dd-open");if(o){n.slideUp("fast");m.removeClass("dd-pointer-up");p.removeClass("dd-open")}else{p.addClass("dd-open");n.slideDown("fast");m.addClass("dd-pointer-up")}i(q)}function l(m){m.find(".dd-select").removeClass("dd-open");m.find(".dd-options").slideUp(50);m.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function h(p){var o=p.find(".dd-select").css("height");var n=p.find(".dd-selected-description");var m=p.find(".dd-selected-image");if(n.length<=0&&m.length>0){p.find(".dd-selected-text").css("lineHeight",o)}}function i(m){m.find(".dd-option").each(function(){var q=f(this);var o=q.css("height");var p=q.find(".dd-option-description");var n=m.find(".dd-option-image");if(p.length<=0&&n.length>0){q.find(".dd-option-text").css("lineHeight",o)}})}})(jQuery);
